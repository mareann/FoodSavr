<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery.js"></script>
<!--     <link href="js/foodSavr.js" type="text/JavaScript"> -->
  </head>
  <body>
<form> <!--  action="/action_page.php"> -->
  First name:<br>
  <input type="text" name="firstname" id="firstName" value=""><br>
  Last name:<br>
  <input type="text" name="lastname" id="lastName" value=""><br><br>
  Food Type:<br>
  <input type="foodTypeId" name="foodtype" id="foodType" value=""><br><br>
  Donor id<br>
    <input type="donorId" name="donor" id="donorId" value=""><br><br>
  Donor Location<br>
    <input type="donorLocation" name="donorLocation" id="locationId" value=""><br><br>
  Donor Comments<br>
    <input type="donorComments" name="donorComments" id="comments" value=""><br><br>
  Available Beg Time<br>
    <input type="availableBegTime" name="availableBegTime" id="begTime" value=""><br><br>
  Available End Time<br>
    <input type="availableEndTime" name=" availableEndTime" id="endTime" value=""><br><br>
  Charity Id<br>
    <input type="charityId" name="CharityId" id="charityId" value=""><br><br>
   
    
  <input type="submit" id="donorSubmit" value="Submit">
</form>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://raw.githubusercontent.com/jerryluk/jquery.autogrow/master/jquery.autogrow-min.js"></script>
<script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
<script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyAWfL63JtMGctEdm1gD6haUVuzBqakG4Hw&v=3.exp'></script>
<script type="text/javascript">
  $( function() {
  // charity submit
console.log("foodSavr")
  $("#donorSubmit").on("click", function(event) { //was async
    event.preventDefault();
    var YardsInMile = 1760;
    var first_name = $("#firstName").val().trim();
    var last_name = $("#lastName").val().trim();
    var food_type = $("#foodType").val().trim();
    var donor_id = $("#donorId").val().trim();
    var location_id = $("#locationId").val().trim();
    var comments = $("#comments").val().trim();
    var start_time = $("#begTime").val().trim();
    var end_time = $("#endTime").val().trim();
    var charity_id = $("#charityId").val().trim();
    var charityPickedUpFlag= 0;
    console.log("name "+first_name+" "+last_name+" food_type "+food_type); 
    console.log("food "+food_type+" donor "+donor_id+" loc "+location_id);
    console.log("comments "+comments);
    console.log("start_time "+start_time+" end_time "+end_time);
    console.log("charity_id "+charity_id);
    console.log("charity pickedup " + charityPickedUpFlag);
//origin 1, Chicago Community Ministry, 6525 N Clark St., Chicago, IL, 60626, Mr. Smith, C123, 1, , (773)761-6688, , , 1, 1, 0, 0, u, p
//destination 2, Food4Less Washington Square, 4821 W North Ave, Chicago, IL, 60639, Ms McDougal, 2, 1, p@food.com, (773)235-1783, @Wash, , 1, 1, 0, 0, m, p

      var origin = "6525 N Clark St., Chicago, IL, 60626";
      var destination = "4821 W North Ave, Chicago, IL, 60639";

      var service = new google.maps.DistanceMatrixService;
        service.getDistanceMatrix({
          origins: [origin],
          destinations: [destination],
          travelMode: 'DRIVING',
          unitSystem: google.maps.UnitSystem.IMPERIAL,
          avoidHighways: false,
          avoidTolls: false
        }, function(response, status) {
          if (status !== 'OK') {
            alert('Error was: ' + status);
          } else {
            var originList = response.originAddresses;
            var destinationList = response.destinationAddresses;
            //var outputDiv = document.getElementById('output');
            //outputDiv.innerHTML = '';
            };

            for (var i = 0; i < originList.length; i++) {
              var results = response.rows[i].elements;
              for (var j = 0; j < results.length; j++) {
                //outputDiv.innerHTML 
               // var output += originList[i] + ' to ' + destinationList[j] +
                //    ': ' + results[j].distance.text + ' in ' +
                //    results[j].duration.text + '<br>';
              }
            }
            console.log("distance results "+JSON.stringify(results));
            var distance = (results[0].distance.value/YardsInMile).toFixed(2);
            console.log("distance is "+distance)

      var newFoodDonation = {
      foodTypeId:       food_type,
      foodImageUrl:     "",
      donorId:          donor_id,
      donorLocation:    location_id,
      donorComments:    comments,
      availableBegTime: start_time,
      availableEndTime: end_time,
      charityId:        charity_id,
      charityPickedUpFlag: 0,
      distanceToCharity: distance
    };

    console.log("newFoodDonation "+JSON.stringify(newFoodDonation));
  // Send the PUT request.
    $.ajax("/api/donations", { //+charity_id, {
      type: "POST",
      data: newFoodDonation
    }).then(
      function() {
        console.log("sent /api/donations", newFoodDonation);
        // Reload the page to get the updated list
        location.reload();
      }
    ); // end .then
           // console.log("distance output "+results);
  }); // end service.getDistanceMatrix function

  }); //donor submit function end
})
</script>
</body>
</html>
